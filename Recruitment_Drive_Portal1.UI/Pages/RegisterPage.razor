@page "/"
@using MudBlazor
@using Recruitment_Drive_Portal1.Shared.Models
@using Recruitment_Drive_Portal1.UI.Interfaces
@inject IRegisterPanel Panel
@inject ISnackbar Snackbar

<MudPaper Elevation="8"
          Class="pa-6 mx-auto mt-10"
          Style="max-width:700px;
                 background: linear-gradient(135deg, #fdfbfb, #ebedee);
                 border-radius:18px;">

    <MudText Typo="Typo.h3"
             Align="Align.Center"
             Color="Color.Primary"
             Class="mb-6">
        Panel Registration Form
    </MudText>

    <MudForm @ref="_form" Model="@panel">

        <MudStack Spacing="3">

            <!-- Name -->
            <MudText Typo="Typo.subtitle1">Name</MudText>
            <MudTextField @bind-Value="panel.Name"
                          Variant="Variant.Outlined"
                          Required="true" />

            <!-- Email -->
            <MudText Typo="Typo.subtitle1">Email</MudText>
            <MudTextField @bind-Value="panel.Email"
                          InputType="InputType.Email"
                          Variant="Variant.Outlined"
                          Required="true" />

            <!-- Phone -->
            <MudText Typo="Typo.subtitle1">Phone Number</MudText>
            <MudTextField @bind-Value="panel.PhoneNumber"
                          Variant="Variant.Outlined"
                          MaxLength="10"
                          Required="true"
                          Validation="ValidatePhoneNumber" />

            <!-- Designation -->
            <MudText Typo="Typo.subtitle1">Designation</MudText>
            <MudTextField @bind-Value="panel.Designation"
                          Variant="Variant.Outlined"
                          Required="true" />

            <!-- Interviewer Type Dropdown -->
            <MudText Typo="Typo.subtitle1">Interviewer Type</MudText>
            <MudSelect T="string"
                       Value="@panel.InterviewerType"
                       ValueChanged="@(v => panel.InterviewerType = v)"
                       Variant="Variant.Outlined"
                       Required="true">

                <MudSelectItem T="string" Value="@("Technical")">Technical</MudSelectItem>
                <MudSelectItem T="string" Value="@("HR")">HR</MudSelectItem>
                <MudSelectItem T="string" Value="@("Managerial")">Managerial</MudSelectItem>

            </MudSelect>




            <!-- Interviewer Mode Dropdown -->
            <MudText Typo="Typo.subtitle1">Interviewer Mode</MudText>
            <MudSelect T="string"
                       Value="@panel.InterviewerMode"
                       ValueChanged="@(v => panel.InterviewerMode = v)"
                       Variant="Variant.Outlined"
                       Required="true">

                <MudSelectItem T="string" Value="@("Online")">Online</MudSelectItem>
                <MudSelectItem T="string" Value="@("Offline")">Offline</MudSelectItem>
                <MudSelectItem T="string" Value="@("Hybrid")">Hybrid</MudSelectItem>

            </MudSelect>



            <!-- Experience -->
            <MudText Typo="Typo.subtitle1">Experience</MudText>
            <MudGrid>
                <MudItem xs="6">
                    <MudNumericField @bind-Value="panel.ExperienceYears"
                                     Label="Years"
                                     Variant="Variant.Outlined"
                                     Min="0"
                                     Max="50"
                                     Required="true" />
                </MudItem>

                <MudItem xs="6">
                    <MudNumericField @bind-Value="panel.ExperienceMonths"
                                     Label="Months"
                                     Variant="Variant.Outlined"
                                     Min="0"
                                     Max="11"
                                     Required="true" />
                </MudItem>
            </MudGrid>

            <!-- Skills -->
            <MudText Typo="Typo.subtitle1">Skills</MudText>
            <MudTextField @bind-Value="panel.Skills"
                          Variant="Variant.Outlined"
                          Required="true"
                          Placeholder="Angular, ASP.NET Core, SQL Server" />

            <!-- Available Date -->
            <MudText Typo="Typo.subtitle1">Available Date</MudText>
            <MudDatePicker @bind-Date="_availableDate"
                           Variant="Variant.Outlined"
                           MinDate="@DateTime.Today"
                           Required="true" />

            <!-- Submit -->
            <MudButton OnClick="Submit"
                       Variant="Variant.Filled"
                       Color="Color.Primary"
                       Size="Size.Large"
                       Class="mt-6"
                       FullWidth="true">
                Register
            </MudButton>

        </MudStack>
    </MudForm>
</MudPaper>





@code {
    private MudForm _form;
    private DateTime? _availableDate;

    private RegisterPanelDTO panel = new()
    {
        CreatedOn = DateTime.Now
    };

    private async Task Submit()
    {
        await _form.Validate();

        if (!_form.IsValid)
            return;

        panel.AvailableDate = DateOnly.FromDateTime(_availableDate!.Value);

        var result = await Panel.RegisterPanelAsync(panel);

        if (result != null)
        {
            Snackbar.Add("Panel registered successfully", Severity.Success);
            ClearForm();
        }
        else
        {
            Snackbar.Add("Registration failed", Severity.Error);
        }
    }

    private void ClearForm()
    {
        panel = new RegisterPanelDTO();
        _availableDate = null;
    }

    private string? ValidatePhoneNumber(string? value)
    {
        if (string.IsNullOrWhiteSpace(value))
            return "Phone number is required";

        if (!System.Text.RegularExpressions.Regex.IsMatch(value, @"^\d{10}$"))
            return "Phone number must contain exactly 10 digits";

        return null;
    }
}


