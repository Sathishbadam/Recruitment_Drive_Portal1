@page "/panels"

@using MudBlazor
@using Recruitment_Drive_Portal1.Shared.Models
@using Recruitment_Drive_Portal1.UI.Interfaces
@inject IRegisterPanel Panel
@inject ISnackbar Snackbar
@inject IJSRuntime JS


<MudTable Items="_panels"
          Hover="true"
          Dense="true"
          Bordered="true"
          Loading="_loading">

    <HeaderContent>
        <MudTh>Name</MudTh>
        <MudTh>Email</MudTh>
        <MudTh>Phone</MudTh>
        <MudTh>Designation</MudTh>
        <MudTh>Interviewer Type</MudTh>
        <MudTh>Interviewer Mode</MudTh>
        <MudTh>Experience</MudTh>
        <MudTh>Skills</MudTh>
        <MudTh>Available Date</MudTh>
    </HeaderContent>

    <RowTemplate>
        <MudTd>@context.Name</MudTd>
        <MudTd>@context.Email</MudTd>
        <MudTd>@context.PhoneNumber</MudTd>
        <MudTd>@context.Designation</MudTd>
        <MudTd>@context.InterviewerType</MudTd>
        <MudTd>@context.InterviewerMode</MudTd>

        <!-- Experience display -->
        <MudTd>
            @context.ExperienceYears years @context.ExperienceMonths months
        </MudTd>

        <MudTd>@context.Skills</MudTd>
        <MudTd>@context.AvailableDate.ToString("yyyy-MM-dd")</MudTd>
    </RowTemplate>

</MudTable>





@code {

    private DateTime? _fromDate;
    private DateTime? _toDate;
    private string? _skill;

    private List<RegisterPanelDTO> _panels = new();
    private bool _loading = false;

    protected override async Task OnInitializedAsync()
    {
        
        await LoadPanelsAsync();
    }

    private async Task Search()
    {
        await LoadPanelsAsync();
    }

    private async Task LoadPanelsAsync()
    {
        _loading = true;

        DateOnly? from = _fromDate.HasValue
            ? DateOnly.FromDateTime(_fromDate.Value)
            : null;

        DateOnly? to = _toDate.HasValue
            ? DateOnly.FromDateTime(_toDate.Value)
            : null;

        _panels = await Panel.GetPanelDetailsAsync(from, to, _skill);

        _loading = false;
    }
    private async Task Download()
    {
        var bytes = await Panel.DownloadPanelDetailsAsync(
        _fromDate.HasValue ? DateOnly.FromDateTime(_fromDate.Value) : null,
        _toDate.HasValue ? DateOnly.FromDateTime(_toDate.Value) : null,
        _skill);

        await JS.InvokeVoidAsync(
            "downloadFile",
            "PanelDetails.xlsx",
            "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
            bytes);
    }
}


